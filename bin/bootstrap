#! /bin/sh

exec 3<&0
exec 0<"$BUILD_BASE/config/treetags"
while read TREE TAG BUNDLE REPO
do
  echo Bootstrapping ${TREE}...
  curl ftp://ftp.mozilla.org/pub/firefox/bundles/$BUNDLE.hg >$BUILD_BASE/source/$BUNDLE.hg
  mkdir -p $BUILD_BASE/source/$TREE
  hg init $BUILD_BASE/source/$TREE
  hg -R $BUILD_BASE/source/$TREE unbundle $BUILD_BASE/source/$BUNDLE.hg
  #rm $BUILD_BASE/source/$BUNDLE.hg
  hg -R $BUILD_BASE/source/$TREE pull https://hg.mozilla.org/$REPO
  hg -R $BUILD_BASE/source/$TREE update $TAG

  if [ "$TREE" != "trunk" ]; then
    hg -R $BUILD_BASE/source/$TREE relink $BUILD_BASE/source/trunk
  fi
done
exec 0<&3
exec 3<&-
