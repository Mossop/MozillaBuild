#! /bin/sh

if [ "$1" ]; then
	BUILD_CONFIG=$1
fi

. $BUILD_BASE/bin/applyconfig

cd $BUILD_BASE
if [ ! -f mozilla/client.mk ]; then
	cvs checkout -A mozilla/client.mk
fi

FLAGS="MOZ_CO_PROJECT=$MOZ_CO_PROJECT"
if [ "$MOZ_CO_DATE" ]; then
  FLAGS="$FLAGS \"MOZ_CO_DATE=$MOZ_CO_DATE\""
fi

echo -n "MOZ_BUILD_DATE=" >$BUILD_BASE/build/codate
pstdate >>$BUILD_BASE/build/codate

if [ "$BUILD_WATCH" ]; then
  make -f mozilla/client.mk 2>&1 checkout $FLAGS | buildwatch
else
  make -f mozilla/client.mk 2>&1 checkout $FLAGS
fi
